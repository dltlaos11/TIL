🌐 Web Hosting

- [🌐 가상 호스팅(Virtual Hosting)의 필요성과 Host 헤더의 탄생](#-가상-호스팅virtual-hosting의-필요성과-host-헤더의-탄생)
  - [3가지 호스팅 방식](#3가지-호스팅-방식)
    - [18장 중요 메시지](#18장-중요-메시지)
- [1. 네트워크 전체 흐름 — 요청에서 서버까지](#1-네트워크-전체-흐름--요청에서-서버까지)
- [2. OSI 계층별 역할 · 주소 · 장치 정리](#2-osi-계층별-역할--주소--장치-정리)
- [3. NIC / MAC / IP 관계 정리](#3-nic--mac--ip-관계-정리)
  - [L2 전달과 L3 라우팅](#l2-전달과-l3-라우팅)
- [4. 전체 패킷 이동 구조 (확대 버전)](#4-전체-패킷-이동-구조-확대-버전)
- [5. 로드밸런서(LB)가 L4/L7로 나뉘는 이유](#5-로드밸런서lb가-l4l7로-나뉘는-이유)
- [6. 서버팜(Server Farm) 구조 이해](#6-서버팜server-farm-구조-이해)
- [7. “서버 스위치 → 서버 NIC”의 의미](#7-서버-스위치--서버-nic의-의미)
  - [ARP의 역할과 동작](#arp의-역할과-동작)
  - [브로드캐스트와 유니캐스트의 차이](#브로드캐스트와-유니캐스트의-차이)
    - [ARP가 요청/응답 모두에서 필요한 이유](#arp가-요청응답-모두에서-필요한-이유)
  - [ARP가 요청/응답 모두에서 필요한 이유](#arp가-요청응답-모두에서-필요한-이유-1)
- [8. IP 기반 가상 호스팅에서 IP가 낭비되는 이유](#8-ip-기반-가상-호스팅에서-ip가-낭비되는-이유)
- [9. 전체 구조 1페이지 요약 (가장 중요한 요약)](#9-전체-구조-1페이지-요약-가장-중요한-요약)
- [10. 면접용 초압축 핵심 7줄](#10-면접용-초압축-핵심-7줄)
- [11. 면접에서 바로 쓰는 답변 예시](#11-면접에서-바로-쓰는-답변-예시)
- [12. 전체 개념도 (텍스트 기반)](#12-전체-개념도-텍스트-기반)
- [🌐 13. 전체 개념도 (완전판, 양방향)](#-13-전체-개념도-완전판-양방향)

---

# 🌐 가상 호스팅(Virtual Hosting)의 필요성과 Host 헤더의 탄생

가상호스팅이란?

하나의 서버가 여러 웹사이트(여러 도메인)를 제공하는 기술.

## 3가지 호스팅 방식

방식 1: IP 기반 가상호스팅
• 도메인마다 서로 다른 IP 필요
• 가상 IP alias 사용 가능하지만 확장성 낮음
• IP 주소 낭비 → IPv4 부족 문제

방식 2: 포트 기반 가상호스팅
• 도메인당 다른 포트 사용
• 사용자 불편 → 거의 사용 안 함

방식 3: Host 헤더 기반 가상호스팅 (HTTP/1.1)
• 하나의 IP/포트에서 여러 사이트 가능

```
GET / HTTP/1.1
Host: example.com
```

• 서버는 Host 값으로 어떤 가상 서버를 사용할지 판단
• 지금의 Apache VirtualHost / Nginx server{} 의 기반

Host 헤더의 중요성
• IP 부족 문제 해결
• 도메인 기반 라우팅 가능
• 리버스 프록시(Nginx)와 CDN의 동작 기반
• 멀티사이트 운영의 표준 방식

### 18장 중요 메시지

1. 하나의 IP로 여러 사이트 운영하고 싶음 → 비용 절감
2. 근데 IP 기반 방식은 IP가 부족함
3. HTTP/1.0에서는 Host 헤더가 없었음
   → 요청이 어느 도메인용인지 서버가 알 수 없음
4. 그래서 HTTP/1.1에서 Host 헤더 추가됨
   → 하나의 IP에서 여러 가상호스트 가능
5. 지금의 모든 웹 호스팅이 Host 기반 가상 호스팅으로 운영됨

즉, Host 헤더는 웹 호스팅 진화의 필연적 해결책이었음.

```
“IP 부족 문제를 해결하기 위해 Host 헤더가 필수 요소가 되었고,
이것이 HTTP/1.1 표준의 핵심 변화 중 하나”
```

# 1. 네트워크 전체 흐름 — 요청에서 서버까지

```bash
Client NIC
→ Client MAC (L2)
→ Client IP (L3)
→ 라우터들 (네트워크 간 이동)
→ LB(L4/L7)
→ 서버 스위치(L2)
→ Server NIC
→ Server App
```

응답(Response)은 이 경로를 그대로 역순으로 따라 클라이언트로 돌아온다.

---

# 2. OSI 계층별 역할 · 주소 · 장치 정리

계층 역할 주소 장치 설명

1. 물리(L1) 전기·광 신호 전달 없음 케이블, 허브 NIC의 물리 인터페이스
2. 데이터링크(L2) LAN 내부 전달 MAC 주소 스위치 로컬 통신, ARP 사용
3. 네트워크(L3) 네트워크 간 이동 IP 주소 라우터 인터넷 라우팅
4. 전송(L4) 프로세스 연결 포트 번호 L4 LB TCP/UDP 기반 분산
5. 애플리케이션(L7) 프로토콜 처리 Host, URL L7 LB HTTP 기반 라우팅

핵심:
• L2 = MAC, 스위치
• L3 = IP, 라우터
• L4/L7 = LB(서버 선택)
• NIC = L1~L2 물리 인터페이스

---

# 3. NIC / MAC / IP 관계 정리

✔ NIC
• 물리·데이터링크 계층 담당
• 패킷을 실제로 송수신하는 장치

✔ MAC 주소
• “LAN 내부 주소”
• 스위치가 MAC 테이블을 보고 포워딩

✔ IP 주소
• “전 세계 주소”
• 라우터가 IP를 보고 네트워크 간 전달

📌 관계 한 줄 요약

NIC = 하드웨어, MAC = LAN 주소, IP = 인터넷 주소

## L2 전달과 L3 라우팅

L2 전달 (스위칭)
• MAC 주소 기반
• LAN 내부 전달
• 스위치가 수행
• 단위: 프레임

L3 전달 (라우팅)
• IP 주소 기반
• 네트워크 간 전달
• 라우터가 수행
• 단위: 패킷

요약:

L2는 LAN 안에서 “어디 포트로?”
L3는 네트워크 간 “어느 네트워크로?”

---

# 4. 전체 패킷 이동 구조 (확대 버전)

▶ Request

```
NIC → MAC → IP → Router들 → LB → Switch → Server NIC → App
```

▶ Response

```
App → Server NIC → Switch → LB → Router들 → IP → MAC → NIC
```

---

# 5. 로드밸런서(LB)가 L4/L7로 나뉘는 이유

✔ L4 LB (전송계층)
• IP + Port 기반
• 빠름
• Payload 분석 불가
• 게임 서버, TCP 서비스 등

✔ L7 LB (애플리케이션 계층)
• Host, URL path, Cookie, Header 등 분석
• 세밀한 라우팅 가능
• 웹서비스, API

📌 한 문장 요약

빠르면 L4, 정교하면 L7.

---

# 6. 서버팜(Server Farm) 구조 이해

```
Client
→ Router
→ LB
→ Switch(L2)
→ [Server1 NIC] → App
→ [Server2 NIC] → App
→ [Server3 NIC] → App
```

LB는 “어떤 서버로 갈지” 결정하고,
스위치는 그 서버 NIC의 MAC 주소를 찾아 포워딩한다.

---

# 7. “서버 스위치 → 서버 NIC”의 의미

```
• LB가 서버1을 선택 → 스위치 → 서버1 NIC
• LB가 서버3을 선택 → 스위치 → 서버3 NIC
```

즉: 이 부분은 ‘선택된 서버에 따라 바뀌는 경로’를 의미한다.

## ARP의 역할과 동작

ARP(Address Resolution Protocol)는:

같은 네트워크에서 IP 주소에 해당하는 MAC 주소를 찾는 프로토콜

왜 필요할까?
• 패킷을 만들 때 OS는 “목적지 IP”만 알고 있음
• LAN에서 실제 전송하려면 “목적지 MAC”이 필요함
• 그래서 ARP가 IP→MAC을 알아낸 뒤 전송 가능

동작 방식

1. ARP Request (브로드캐스트)
   ```
   FF:FF:FF:FF:FF:FF
   "이 IP 가진 사람 누구야? MAC 알려줘!"
   ```
2. ARP Reply (유니캐스트)
   ```
   "나야! MAC은 aa:bb:cc:dd:ee:ff"
   ```
3. ARP 테이블에 저장(IP–MAC 매핑)

4. 이후 유니캐스트로 전송

## 브로드캐스트와 유니캐스트의 차이

브로드캐스트
• 같은 LAN 전체로 전송
• 목적지 MAC: FF:FF:FF:FF:FF:FF
• ARP Request, DHCP Discover 등이 해당

유니캐스트
• 특정 단일 장비로 전송
• 목적지 MAC: 대상 NIC의 MAC
• ARP Reply, 실제 데이터 전송 등이 해당

요약:
ARP는 브로드캐스트로 시작해 유니캐스트로 끝난다.

```
LAN (L2 영역)
 ┌──────────┐
 │  Switch  │ ← MAC 기반
 └──────────┘
    │   │   │
 PC1 PC2 PC3  ← MAC 기반 통신

      ↓ L3 장비(라우터를 지나면)

WAN/인터넷 (L3 영역)
```

### ARP가 요청/응답 모두에서 필요한 이유

ARP는 특정 방향이 아니라,

패킷을 내보내는 장비(OS/서버/라우터)가
목적지 MAC을 모를 때 언제든 발생하는 과정

즉:
• 클라이언트가 서버로 요청할 때
• 서버가 클라이언트로 응답할 때
• 라우터가 다음 홉으로 패킷을 보낼 때
• LB가 서버 NIC로 보낼 때

항상 IP를 알고 MAC을 모르면 ARP 사용.

ARP는 요청/응답 중 어느 한 쪽의 개념이 아니라
전송 전에 반드시 필요한 L2–L3 연결 메커니즘이다.

## ARP가 요청/응답 모두에서 필요한 이유

ARP는 특정 방향이 아니라,

패킷을 내보내는 장비(OS/서버/라우터)가
목적지 MAC을 모를 때 언제든 발생하는 과정

즉:
• 클라이언트가 서버로 요청할 때
• 서버가 클라이언트로 응답할 때
• 라우터가 다음 홉으로 패킷을 보낼 때
• LB가 서버 NIC로 보낼 때

항상 IP를 알고 MAC을 모르면 ARP 사용.

ARP는 요청/응답 중 어느 한 쪽의 개념이 아니라
전송 전에 반드시 필요한 L2–L3 연결 메커니즘이다.

---

# 8. IP 기반 가상 호스팅에서 IP가 낭비되는 이유

• 사이트마다 IP가 필요함
• NIC 하나에 가상 IP를 여러 개 붙일 수 있으나 한계가 있음
• IPv4 부족 문제와 직결됨
→ 그래서 `Host 헤더 기반 가상 호스팅(HTTP/1.1)`이 표준이 됨

---

# 9. 전체 구조 1페이지 요약 (가장 중요한 요약)

```
[클라이언트]
NIC → MAC → IP → Router들 → LB → Switch → Server NIC → App
```

    •	MAC은 L2 로컬 주소
    •	IP는 L3 글로벌 주소
    •	스위치는 MAC 기반 전달
    •	라우터는 IP 기반 전달
    •	LB는 L4/L7에서 서버 선택
    •	서버 스위치는 해당 서버 NIC로 전달

---

# 10. 면접용 초압축 핵심 7줄

1. MAC은 LAN 주소, IP는 인터넷 주소
2. 스위치는 L2(MAC 기반), 라우터는 L3(IP 기반)
3. NIC는 패킷을 실제로 송수신
4. 요청은 NIC → MAC → IP → LB → 서버 NIC
5. 응답은 그 반대 방향으로 돌아옴
6. LB는 L4/L7에서 서버 선택
7. 서버 스위치는 그 서버 NIC로 패킷을 포워딩

---

# 11. 면접에서 바로 쓰는 답변 예시

✔ “NIC / MAC / IP 차이는?”

NIC는 패킷을 실제로 송수신하는 L1~L2 장비이고,
MAC은 LAN 내부 주소(L2),
IP는 네트워크 간 이동을 위한 L3 주소입니다.

✔ “스위치와 라우터 차이는?”

스위치는 MAC 기반 L2 전달,

```
L2 전달은 데이터링크 계층에서 MAC 주소 기반으로
같은 LAN 내부의 목적지 NIC로 프레임을 전달하는 동작입니다.
스위치가 이 역할을 수행합니다.
```

라우터는 IP 기반 L3 라우팅입니다.

```
✔ 기본 정의

L3 전달은 네트워크 계층에서 IP 주소를 기반으로
목적지 네트워크까지 패킷을 전달하는 과정이다.

✔ 조금 더 상세한 면접 버전

라우터가 패킷의 목적지 IP 주소를 읽고,
라우팅 테이블을 참조하여
“다음 네트워크(next hop)”로 패킷을 전달하는 동작이다.
```

✔ “L4 LB와 L7 LB 차이는?”

L4는 IP/Port만 보고 빠르게 분산,
L7은 URL/헤더까지 보고 정교하게 라우팅합니다.

✔ “요청이 서버까지 어떻게 도달하나요?”

NIC→MAC→IP→라우터→LB→스위치→서버 NIC→앱 순입니다.

---

# 12. 전체 개념도 (텍스트 기반)

```
Client NIC
└─ MAC (LAN 전달)
└─ IP (인터넷 라우팅)
└─ Router들 (경로 이동)
└─ LB(L4/L7) ← 서버 선택
└─ Switch(L2)
└─ Server NIC
└─ Server App
```

---

맞아요!
현재 그 다이어그램은 요청(Request) 방향만 표현되어 있고,
응답(Response) 흐름은 포함되어 있지 않습니다.

그러면 전체 구조를 요청 + 응답 모두 포함한 완성판으로 다시 정리해서 드릴게요.

---

✅ 전체 개념도 (Request + Response 완전 포함 버전)

📌 요청(Request): Client → Server

📌 응답(Response): Server → Client

아래는 양방향을 모두 포함한 네트워크 전체 흐름입니다.

---

# 🌐 13. 전체 개념도 (완전판, 양방향)

```

                   [ Request ]

Client NIC
└─ MAC (LAN 내 전달)
└─ IP (인터넷 라우팅)
└─ Router들 (경로 이동)
└─ LB(L4/L7, 서버 선택)
└─ Switch(L2)
└─ Server NIC
└─ Server App
                   [ Response ]
Server App
└─ Server NIC
└─ Switch(L2)
└─ LB (연결 유지 / NAT 처리)
└─ Router들 (인터넷 경로)
└─ Client IP
└─ Client MAC
└─ Client NIC
```

---

🔍 구조를 더 직관적으로 보면:

▶ 요청 흐름

```

Client → NIC → MAC → IP → Router → LB → Switch → Server NIC → Server App
```

▶ 응답 흐름

```

Server App → Server NIC → Switch → LB → Router → Client IP → Client MAC → Client NIC
```

요약하면:
• MAC은 항상 LAN 내부 전달 역할
• IP는 네트워크 간 라우팅 역할
• LB는 요청/응답 모두를 거침
• Switch는 서버 내부 LAN에서 목적지 NIC를 찾음
• NIC는 양쪽 모두에서 실제 패킷 송수신

---

⭐ 더 중요한 포인트

```
✔ 요청은 LB가 서버를 선택하는 과정

✔ 응답은 LB가 경로를 유지하는 과정
```

LB는 요청 때만 선택하는 것이 아니라,
응답이 정확히 그 사용자에게 되돌아가도록 세션/커넥션을 유지합니다.

그래서 LB는 Request와 Response 모두를 통과합니다.
