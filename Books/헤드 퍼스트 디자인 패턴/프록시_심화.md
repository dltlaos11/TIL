# í”„ë¡ì‹œ íŒ¨í„´ ì‹¬í™” - ìƒíƒœ íŒ¨í„´, ì–´ëŒ‘í„° íŒ¨í„´, ë³´í˜¸ í”„ë¡ì‹œ, ë™ì  í”„ë¡ì‹œ

## ğŸ¯ ìƒíƒœ íŒ¨í„´ìœ¼ë¡œ ifë¬¸ ì œê±°í•˜ê¸°

### ë¬¸ì œ: ì¡°ê±´ë¬¸ìœ¼ë¡œ ìƒíƒœë³„ ë¡œì§ ë¶„ê¸°

```java
// Before: ë³µì¡í•œ ifë¬¸ë“¤
public class ImageProxy {
    private ImageIcon imageIcon;
    private boolean retrieving;

    public void paintIcon() {
        if (imageIcon != null) {
            imageIcon.paintIcon();           // ìƒíƒœ 1ì˜ ë¡œì§
        } else if (retrieving) {
            paintLoadingMessage();           // ìƒíƒœ 2ì˜ ë¡œì§
        } else {
            paintLoadingMessage();           // ìƒíƒœ 3ì˜ ë¡œì§
            retrieving = true;
            startImageLoading();
        }
    }
}
```

### í•´ê²°: ìƒíƒœ íŒ¨í„´ìœ¼ë¡œ ifë¬¸ ì™„ì „ ì œê±°

```java
// ìƒíƒœ ì¸í„°í˜ì´ìŠ¤
public interface ImageState {
    void paintIcon(ImageProxy proxy);
    int getIconWidth(ImageProxy proxy);
    int getIconHeight(ImageProxy proxy);
}

// ê° ìƒíƒœê°€ ìì‹ ë§Œì˜ ë¡œì§ ë³´ìœ 
public class ImageNotLoadedState implements ImageState {
    public void paintIcon(ImageProxy proxy) {
        proxy.paintLoadingMessage();
        proxy.setState(new ImageLoadingState());  // ìƒíƒœ ì „ì´
        proxy.startImageLoading();
    }
}

public class ImageLoadedState implements ImageState {
    private ImageIcon imageIcon;

    public void paintIcon(ImageProxy proxy) {
        imageIcon.paintIcon();  // ì‹¤ì œ ì´ë¯¸ì§€ í‘œì‹œ
    }
}

// ImageProxy: ifë¬¸ ì—†ì´ ë‹¨ìˆœ ìœ„ì„
public class ImageProxy {
    private ImageState state = new ImageNotLoadedState();

    public void paintIcon() {
        state.paintIcon(this);  // ifë¬¸ ì—†ìŒ! ìƒíƒœê°€ ì•Œì•„ì„œ ì²˜ë¦¬
    }
}
```

### í•µì‹¬: ì¡°ê±´ë¬¸ì„ ê°ì²´ë¡œ ë°”ê¾¸ëŠ” ë§ˆë²•

```java
// Before: if (ìƒíƒœ1) { ë¡œì§1 } else if (ìƒíƒœ2) { ë¡œì§2 }
// After: currentState.execute() // ìƒíƒœ ê°ì²´ê°€ ìì‹ ì˜ ë¡œì§ ì‹¤í–‰!
```

---

## ğŸ”Œ ì–´ëŒ‘í„° vs í”„ë¡ì‹œ íŒ¨í„´

### í•µì‹¬ ì°¨ì´ì 

```java
// í”„ë¡ì‹œ: ê°™ì€ ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©
Icon proxy = new ImageProxy("image.jpg");    // Icon ì¸í„°í˜ì´ìŠ¤
Icon real = new RealImageIcon("image.jpg");  // Icon ì¸í„°í˜ì´ìŠ¤ (ë™ì¼!)

// ì–´ëŒ‘í„°: ì¸í„°í˜ì´ìŠ¤ ë³€í™˜
MediaPlayer player = new AudioAdapter("mp3"); // MediaPlayer ì¸í„°í˜ì´ìŠ¤
// ë‚´ë¶€ì ìœ¼ë¡œëŠ” AdvancedMediaPlayer ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš© (ë‹¤ë¦„!)
```

### ì–´ëŒ‘í„° íŒ¨í„´ ì™„ì „ ì˜ˆì‹œ: í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ì¸í„°í˜ì´ìŠ¤ ì—°ê²°

```java
// í´ë¼ì´ì–¸íŠ¸ê°€ ì›í•˜ëŠ” ìƒˆ ì¸í„°í˜ì´ìŠ¤
public interface MediaPlayer {
    void play(String audioType, String fileName);
}

// ê¸°ì¡´ ì‹œìŠ¤í…œ (ë‹¤ë¥¸ ì¸í„°í˜ì´ìŠ¤)
public interface AdvancedMediaPlayer {
    void playVlc(String fileName);
    void playMp4(String fileName);
}

public class VlcPlayer implements AdvancedMediaPlayer {
    public void playVlc(String fileName) {
        System.out.println("Playing vlc file: " + fileName);
    }
    public void playMp4(String fileName) { /* ë¹ˆ êµ¬í˜„ */ }
}

// ì–´ëŒ‘í„°: ì¸í„°í˜ì´ìŠ¤ ë³€í™˜ê¸°
public class MediaAdapter implements MediaPlayer {
    AdvancedMediaPlayer advancedPlayer;

    public MediaAdapter(String audioType) {
        if (audioType.equals("vlc")) {
            advancedPlayer = new VlcPlayer();
        }
    }

    public void play(String audioType, String fileName) {
        // ì¸í„°í˜ì´ìŠ¤ ë³€í™˜!
        if (audioType.equals("vlc")) {
            advancedPlayer.playVlc(fileName);  // ìƒˆ ì¸í„°í˜ì´ìŠ¤ â†’ êµ¬ ì¸í„°í˜ì´ìŠ¤
        }
    }
}

// ì‚¬ìš©: í´ë¼ì´ì–¸íŠ¸ëŠ” í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤ë¡œ ì‚¬ìš©
MediaPlayer player = new MediaAdapter("vlc");
player.play("vlc", "movie.vlc");  // ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤
```

---

## ğŸ›¡ï¸ ë³´í˜¸ í”„ë¡ì‹œ: ì ‘ê·¼ ê¶Œí•œ ì œì–´

### ê¶Œí•œ ê¸°ë°˜ ì ‘ê·¼ ì œì–´

```java
// ê°œì¸ì •ë³´ ì¸í„°í˜ì´ìŠ¤
public interface PersonBean {
    String getName();
    void setName(String name);
    void setHotOrNotRating(int rating);
}

// ë³¸ì¸ìš© ë³´í˜¸ í”„ë¡ì‹œ
public class OwnerProtectionProxy implements PersonBean {
    PersonBean person;

    public void setName(String name) {
        person.setName(name);  // âœ… í—ˆìš©: ìê¸° ì •ë³´ ìˆ˜ì •
    }

    public void setHotOrNotRating(int rating) {
        throw new IllegalArgumentException("ìê¸° ìì‹ ì—ê²Œ í‰ì ì„ ì¤„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");  // âŒ ì°¨ë‹¨
    }
}

// íƒ€ì¸ìš© ë³´í˜¸ í”„ë¡ì‹œ
public class NonOwnerProtectionProxy implements PersonBean {
    PersonBean person;

    public void setName(String name) {
        throw new IllegalArgumentException("ë‹¤ë¥¸ ì‚¬ëŒì˜ ì´ë¦„ì„ ë°”ê¿€ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");  // âŒ ì°¨ë‹¨
    }

    public void setHotOrNotRating(int rating) {
        person.setHotOrNotRating(rating);  // âœ… í—ˆìš©: í‰ì  ì£¼ê¸°
    }
}
```

---

## ğŸ­ Java ë™ì  í”„ë¡ì‹œ: InvocationHandlerì˜ ë§ˆë²•

### ìˆ˜ë™ í”„ë¡ì‹œì˜ ë¬¸ì œì 

```java
// âŒ ë§¤ë²ˆ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ì‘ì„±
public class OwnerProtectionProxy implements PersonBean {
    // ëª¨ë“  ë©”ì„œë“œë¥¼ ì¼ì¼ì´ êµ¬í˜„í•´ì•¼ í•¨
    public String getName() { return person.getName(); }
    public void setName(String name) { person.setName(name); }
    // ... ë” ë§ì€ ë°˜ë³µ ì½”ë“œ
}
```

### ë™ì  í”„ë¡ì‹œë¡œ í•´ê²°

```java
// âœ… í•˜ë‚˜ì˜ Handlerë¡œ ëª¨ë“  ë©”ì„œë“œ ì²˜ë¦¬!
public class OwnerInvocationHandler implements InvocationHandler {
    PersonBean person;

    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        try {
            // getter ë©”ì„œë“œ: ëª¨ë‘ í—ˆìš©
            if (method.getName().startsWith("get")) {
                return method.invoke(person, args);
            }
            // ê°œì¸ì •ë³´ setter: í—ˆìš©
            else if (method.getName().equals("setName")) {
                return method.invoke(person, args);
            }
            // í‰ì  ì„¤ì •: ì°¨ë‹¨
            else if (method.getName().equals("setHotOrNotRating")) {
                throw new IllegalAccessException("ìê¸° ìì‹ ì—ê²Œ í‰ì ì„ ì¤„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null;
    }
}

// ë™ì  í”„ë¡ì‹œ ìƒì„±
public static PersonBean getOwnerProxy(PersonBean person) {
    return (PersonBean) Proxy.newProxyInstance(
        person.getClass().getClassLoader(),     // í´ë˜ìŠ¤ ë¡œë”
        person.getClass().getInterfaces(),      // êµ¬í˜„í•  ì¸í„°í˜ì´ìŠ¤ë“¤
        new OwnerInvocationHandler(person)      // InvocationHandler
    );
}
```

### ì–´ë…¸í…Œì´ì…˜ ê¸°ë°˜ ê¶Œí•œ ì œì–´

```java
// ê¶Œí•œ ì–´ë…¸í…Œì´ì…˜
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface RequiresRole {
    String value();
}

// ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤
public interface BankService {
    @RequiresRole("USER")
    double getBalance();

    @RequiresRole("ADMIN")
    void deleteAccount();
}

// ê¶Œí•œ ê²€ì‚¬ Handler
public class SecurityInvocationHandler implements InvocationHandler {
    private Object target;
    private String userRole;

    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        RequiresRole annotation = method.getAnnotation(RequiresRole.class);

        if (annotation != null) {
            String requiredRole = annotation.value();
            if (!userRole.equals(requiredRole)) {
                throw new SecurityException("ì ‘ê·¼ ê±°ë¶€: " + requiredRole + " ê¶Œí•œ í•„ìš”");
            }
        }

        return method.invoke(target, args);  // ê¶Œí•œ ìˆìœ¼ë©´ ì‹¤í–‰
    }
}
```

---

## ğŸ” Class í´ë˜ìŠ¤ì˜ ë¦¬í”Œë ‰ì…˜ ë©”ì„œë“œë“¤

### getClassLoader()ì™€ getInterfaces()

```java
PersonBean person = new PersonBeanImpl();

// Class í´ë˜ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ë©”ì„œë“œë“¤
ClassLoader loader = person.getClass().getClassLoader();    // í´ë˜ìŠ¤ ë¡œë” ì •ë³´
Class<?>[] interfaces = person.getClass().getInterfaces();  // êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ë“¤

// ë™ì  í”„ë¡ì‹œì— í•„ìˆ˜ ì •ë³´ ì œê³µ
PersonBean proxy = (PersonBean) Proxy.newProxyInstance(
    loader,      // ì–´ë””ì„œ ë¡œë“œí• ì§€
    interfaces,  // ì–´ë–¤ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„í• ì§€
    handler      // ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€
);
```

### Class í´ë˜ìŠ¤ì˜ ìœ ìš©í•œ ë©”ì„œë“œë“¤

```java
Class<?> clazz = obj.getClass();

// ê¸°ë³¸ ì •ë³´
clazz.getName()              // "com.example.PersonBeanImpl"
clazz.getSimpleName()        // "PersonBeanImpl"
clazz.getPackage()           // íŒ¨í‚¤ì§€ ì •ë³´

// êµ¬ì¡° ì •ë³´
clazz.getSuperclass()        // ë¶€ëª¨ í´ë˜ìŠ¤
clazz.getInterfaces()        // êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ë“¤
clazz.getDeclaredMethods()   // ì„ ì–¸ëœ ë©”ì„œë“œë“¤
clazz.getDeclaredFields()    // ì„ ì–¸ëœ í•„ë“œë“¤

// í´ë˜ìŠ¤ ë¡œë”
clazz.getClassLoader()       // í´ë˜ìŠ¤ ë¡œë”
```

---

## ğŸª ì‹¤ì „ í™œìš©: ë©€í‹°ìŠ¤ë ˆë“œì™€ ë™ê¸°í™”

### ë¹„ë™ê¸° + ë™ê¸°í™” ì¡°í•©ì˜ í•µì‹¬

```java
// ì „ì²´ì ìœ¼ë¡œëŠ” ë¹„ë™ê¸° (ì‚¬ìš©ì ê²½í—˜)
public void paintIcon() {
    if (imageIcon != null) {
        imageIcon.paintIcon();  // ì¦‰ì‹œ í‘œì‹œ
    } else {
        paintLoadingMessage();  // ì¦‰ì‹œ ë¡œë”© í™”ë©´

        // ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì‹œì‘ (ë¹„ë™ê¸°!)
        Thread.start(() -> loadImage());
    }
    // ë©”ì„œë“œ ì¦‰ì‹œ ì¢…ë£Œ - ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ!
}

// ê³µìœ  ìì› ì ‘ê·¼ì‹œì—ë§Œ ë™ê¸°í™” (ë°ì´í„° ì•ˆì „ì„±)
private void loadImage() {
    ImageIcon icon = downloadFromNetwork();  // ê¸´ ì‘ì—… (ë¹„ë™ê¸°)

    // ì„ê³„ì˜ì—­: ìµœì†Œí•œì˜ ë™ê¸°í™”
    synchronized(this) {  // 0.001ì´ˆë§Œ ë¸”ë¡œí‚¹
        imageIcon = icon;
        retrieving = false;
    }
}
```

### volatileê³¼ synchronizedì˜ ì—­í• 

```java
public class ImageProxy {
    private volatile ImageIcon imageIcon;  // ê°€ì‹œì„± ë³´ì¥ (ë©”ì¸ ë©”ëª¨ë¦¬ ì½ê¸°/ì“°ê¸°)
    private boolean retrieving;

    public synchronized void setImageIcon(ImageIcon icon) {  // ë™ì‹œ ì ‘ê·¼ ë°©ì§€
        this.imageIcon = icon;
    }
}
```

---

## ğŸ­ íŒ©í† ë¦¬ ë©”ì„œë“œ vs í…œí”Œë¦¿ ë©”ì„œë“œ

### íŒ©í† ë¦¬ ë©”ì„œë“œ: ìƒì† ê¸°ë°˜ ê°ì²´ ìƒì„±

```java
// ì¶”ìƒ Creator
public abstract class PizzaStore {
    // íŒ©í† ë¦¬ ë©”ì„œë“œ - ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ êµ¬í˜„
    protected abstract Pizza createPizza(String type);

    // í…œí”Œë¦¿ ë©”ì„œë“œ - ë³€í•˜ì§€ ì•ŠëŠ” ì•Œê³ ë¦¬ì¦˜
    public final Pizza orderPizza(String type) {
        Pizza pizza = createPizza(type);  // íŒ©í† ë¦¬ ë©”ì„œë“œ í˜¸ì¶œ
        pizza.prepare();
        pizza.bake();
        return pizza;
    }
}

// ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ ê°ì²´ ìƒì„± ë‹´ë‹¹ (ìƒì†!)
public class NYPizzaStore extends PizzaStore {
    protected Pizza createPizza(String type) {
        return new NYStyleCheesePizza();  // ìƒì†ë°›ì€ í´ë˜ìŠ¤ê°€ êµ¬ì²´ì  ê°ì²´ ìƒì„±
    }
}
```

### í…œí”Œë¦¿ ë©”ì„œë“œ: ì•Œê³ ë¦¬ì¦˜ êµ¬ì¡° ì •ì˜

```java
public abstract class DataProcessor {
    // í…œí”Œë¦¿ ë©”ì„œë“œ - ì²˜ë¦¬ ì•Œê³ ë¦¬ì¦˜ì˜ ë¼ˆëŒ€
    public final void processData() {
        readData();      // 1. ê³µí†µ ë‹¨ê³„
        processData();   // 2. ê°€ë³€ ë‹¨ê³„ (ì„œë¸Œí´ë˜ìŠ¤ë§ˆë‹¤ ë‹¤ë¦„)
        saveData();      // 3. ê³µí†µ ë‹¨ê³„
    }

    protected abstract void processData();  // ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ êµ¬í˜„
}
```

---

## ğŸ’¡ í•µì‹¬ ê°œë… ì •ë¦¬

### íŒ¨í„´ë“¤ì˜ ëª©ì  ì°¨ì´

```java
// í”„ë¡ì‹œ: "ëŒ€ì‹  ì¼í•˜ëŠ” ë¹„ì„œ" (ì ‘ê·¼ ì œì–´)
ImageProxy proxy = new ImageProxy("image.jpg");  // ê°™ì€ ì¸í„°í˜ì´ìŠ¤

// ì–´ëŒ‘í„°: "í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ê²ƒì„ ì—°ê²°í•˜ëŠ” ë³€í™˜ê¸°" (ì¸í„°í˜ì´ìŠ¤ ë³€í™˜)
MediaPlayer adapter = new MediaAdapter("vlc");   // ë‹¤ë¥¸ ì¸í„°í˜ì´ìŠ¤

// ìƒíƒœ íŒ¨í„´: "ì¡°ê±´ë¬¸ì„ ê°ì²´ë¡œ ë°”ê¾¸ëŠ” ê¸°ë²•" (ifë¬¸ ì œê±°)
currentState.execute();  // ìƒíƒœ ê°ì²´ê°€ ì•Œì•„ì„œ ë¡œì§ ì‹¤í–‰

// ë™ì  í”„ë¡ì‹œ: "í•˜ë‚˜ì˜ Handlerë¡œ ëª¨ë“  í”„ë¡ì‹œ ì²˜ë¦¬" (ì½”ë“œ ì¬ì‚¬ìš©)
handler.invoke(proxy, method, args);  // ëª¨ë“  ë©”ì„œë“œ í˜¸ì¶œì„ Handlerê°€ ì²˜ë¦¬
```

### ë©€í‹°ìŠ¤ë ˆë“œ ì² í•™

```java
// ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ ë¹„ë™ê¸°ë¡œ ì‘ì—…í•˜ë˜,
// ë°ì´í„° ì•ˆì „ì„±ì„ ìœ„í•´ ê³µìœ  ìì› ì ‘ê·¼ì‹œì—ë§Œ ë™ê¸°í™”
while (true) {
    executeAsynchronously(() -> {        // ë¹„ë™ê¸° ì‹¤í–‰
        Object result = longRunningTask();

        synchronized(sharedResource) {   // ì„ê³„ì˜ì—­ë§Œ ë™ê¸°í™”
            sharedResource.update(result);
        }
    });
}
```

### ë¦¬í”Œë ‰ì…˜ì˜ í•µì‹¬

```java
// Class ê°ì²´ = í´ë˜ìŠ¤ì˜ ë©”íƒ€ë°ì´í„°
Class<?> clazz = obj.getClass();

// ëŸ°íƒ€ì„ì— í´ë˜ìŠ¤ êµ¬ì¡° ë¶„ì„ ë° ì¡°ì‘
Method method = clazz.getMethod("methodName");
method.invoke(obj, args);  // ë™ì  ë©”ì„œë“œ í˜¸ì¶œ

// ë™ì  í”„ë¡ì‹œ = ë¦¬í”Œë ‰ì…˜ + ì¸í„°í˜ì´ìŠ¤
Object proxy = Proxy.newProxyInstance(loader, interfaces, handler);
```

**ê²°ë¡ : ê° íŒ¨í„´ì€ ì„œë¡œ ë‹¤ë¥¸ ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ë§Œ, ì¡°í•©í•˜ë©´ ë”ìš± ê°•ë ¥í•œ ì„¤ê³„ê°€ ê°€ëŠ¥**
